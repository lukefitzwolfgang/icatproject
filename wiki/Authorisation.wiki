#summary Notes for authorisation mechanism useful for developers

= Introduction =
The authorisation mechanism is based on model with roles & actions. The idea behind this is that the new roles and actions can be created with minimal change to the authorisation code.
The logic of a particular role performing an action can be checked before performing the action.
eg: an READER role can do only reading action this means the code logic for performing read can check whether user can read. 
Table that is associated with the roles and actions are provided in *ICAT_ROLE*

The icat authorisation can be applied to Investigation or Dataset, The elements that are in element hierarchy for each of them are given below.
 * *Investigation*
   * Keywords
   * Investigator
   * Sample
   * Publication
   * Topic
 * *Dataset*
   * Dataset Parameter
   * Datafile
   * Datafile Parameter
   * Related Datafile
Any operation on these elements needs appropriate authorisation entry of its parent in 
*ICAT_AUTHORISATION* table. 

==*ICAT_AUTHORISATION Details*==
This table has following fields with details
||Column||Description||
||ID||Key of the ICAT Authorisation entry||
||USER_ID||This is the user id used in authorisation, can be one of these <br>  fedid<br> 'ANY' keyword for any registered user <br> GUARDIAN for the process with adds data on behalf of facility <br>  SUPER_USER for super user||
||ROLE||ROLE from the ICAT_ROLE table||
||ELEMENT_TYPE||Can be INVESTIGATION or DATASET||
||ELEMENT_ID||This is generally the id associated with the ELEMENT_TYPE element for which authorisation is set. the exception are: <br> If null and ELEMENT_TYPE='DATASET' then user can create datasets for the linked investigation depending on the user ROLE permission.<br> if null and ELEMENT_TYPE='INVESTIGATION' this means the user can create investigations; in practice only two record like this should exist in ICAT, one for GUARDIAN and one for the SUPER_USER. ||
||PARENT_ELEMENT_TYPE||This is there for quick lookup of parent element type of ELEMENT_ID, usually used for DATASET elements||
||PARENT_ELEMENT_ID||This is parent key id for the element||
||USER_CHILD_RECORD|| TODO:? ||

==*ICAT_ROLE*==
This table has the Role and Actions that are allowed,
||Column||Description||
||ROLE||Name of the ROLE||
||ACTION_INSERT||User can insert/create new child of the element <br>'Y' - Yes <br> 'N' - No||
||ACTION_SELECT||User can read anything in the EH<br><br>'Y' - Yes <br> 'N' - No||
||ACTION_DOWNLOAD||User can Download any relevent entities in the EH<br>'Y' - Yes <br> 'N' - No||
||ACTION_UPDATE||User can Update anything in the EH<br>'Y' - Yes <br> 'N' - No||
||ACTION_DELETE||User can mark as deleted any child element of the EH but not root<br>'Y' - Yes <br> 'N' - No||
||ACTION_REMOVE||User can remove/permanently any child of the EH but not the root<br>'Y' - Yes <br> 'N' - No||
||ACTION_ROOT_INSERT||User can create a new EH, i.e for INVESTIGATION can create DATASETs and for DATASET can create DATAFILEs<br>'Y' - Yes <br> 'N' - No||
||ACTION_ROOT_REMOVE||User can remove/permanently delete an EH<br>'Y' - Yes <br> 'N' - No||
||ACTION_SET_FA||User can set and unset FACILITY_ACQUIRED in any of the EH<br>'Y' - Yes <br> 'N' - No||
||ACTION_MANAGE_USERS||User can add or remove users from EH (but not other ICAT_ADMIN's they did not create)<br>'Y' - Yes <br> 'N' - No||
||ACTION_SUPER||User can theoretically do anything that one could do with direct access to ICAT system eg via SQL. In practice this is limited to the maximum available functionality of the ICAT API.<br>'Y' - Yes <br> 'N' - No||

 * Default Role
||Role||Actions||
||READER||select||
||DOWNLOADER||select,download||
||UPDATER||select,download,update||
||DELETER||select,download,update,delete||
||CREATOR||select,insert,download,update,delete,root_insert,manage_users||
||ADMIN||select,insert,download,update,delete,remove,root_insert,manage_users||
||ICAT_ADMIN||select,insert,download,update,delete,remove,root_insert,root_remove,set_fa,manage_users||
||SUPER||select,insert,download,update,delete,remove,root_insert,root_remove,set_fa,manager_users,super||

[http://icatproject.googlecode.com/svn/Images/ICAT_Authorisation.JPG]<br>
This Figure shows the Element Hierarchy.

==Eg:==
1) User 'A'(56789) is an investigator in Investigation 'Investigation-1'(2000) and has a creator rights and can create datafiles in Dataset 'Dataset-1'(4000).
A) There will be two entries in the Authroisation table as below
||ID||USER_ID||ROLE||ELEMENT_TYPE||ELEMENT_ID||PARENT_ELEMENT_TYPE||PARENT_ELEMENT_ID||USER_CHILD_RECORD||
||1001||56789||CREATOR||INVESTIGATION||2000||NULL||NULL||NULL||
||1002||56789||CREATOR||DATASET||4000||INVESTIGATION||2000||NULL||

2) User 'A'(56789) is an investigator in Investigation 'Investigation-1'(2000) and has a creator rights and can create any datasets in the investigation. <br>
A) There will be two entries in the Authroisation table as below
||ID||USER_ID||ROLE||ELEMENT_TYPE||ELEMENT_ID||PARENT_ELEMENT_TYPE||PARENT_ELEMENT_ID||USER_CHILD_RECORD||
||1001||56789||CREATOR||INVESTIGATION||2000||NULL||NULL||1002||
||1002||56789||CREATOR||DATASET||NULL||INVESTIGATION||2000||NULL||

3) User 'B' (56790) is an investigator in Investigation 'Investigation-1'(2000) and has a creator rights ie. can only change Investigation hierarchy but cannot add or access datasets.<br>
A) There will be only one entry in the authroisation table as below.
||ID||USER_ID||ROLE||ELEMENT_TYPE||ELEMENT_ID||PARENT_ELEMENT_TYPE||PARENT_ELEMENT_ID||USER_CHILD_RECORD||
||1003||56790||CREATOR||INVESTIGATION||2000||NULL||NULL||NULL||

4) User 'C' (56791) is an scientist who can only access metadata information and download files in a dataset dataset-1 (4000) but cannot get the information about the investigation. <br>
A) There will be only one entry in the authorisation table as below.
||ID||USER_ID||ROLE||ELEMENT_TYPE||ELEMENT_ID||PARENT_ELEMENT_TYPE||PARENT_ELEMENT_ID||USER_CHILD_RECORD||
||1004||56791||DOWNLOADER||DATASET||4000||INVESTIGATION||2000||NULL||

5) User 'Admin' (1) is an ICAT admin. <br>
A) There will be only one entry in the authorisation table as below.
||ID||USER_ID||ROLE||ELEMENT_TYPE||ELEMENT_ID||PARENT_ELEMENT_TYPE||PARENT_ELEMENT_ID||USER_CHILD_RECORD||
||1005||1||ICAT_ADMIN||NULL||NULL||NULL||NULL||NULL||

= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages