#summary Notes on how to run multiple ICATs.

= Multiple ICATs =
This guide is specific for the latest ICAT4.0 on Linux distributions. 


It is possible to have multiple ICATs without the need of creating another user or the use of more than one glassfish.

== Single Glassfish Domain ==

The process of having several versions of ICAT under a single domain were initially investigated. Unfortunately this was not a viable solution as the information about the jdbc connection pools was burned into ICAT.

== Multiple Glassfish Domains ==

The simplest solution was to create multiple domains on Glassfish to deploy ICATs onto. Please follow the below steps to deploy multiple ICATs.

1. Download a copy of the latest ICAT through svn into a separate directory:
{{{
svn checkout https://icatproject.googlecode.com/svn/ops/icat40 icat40b
}}}


2. Create a new domain;
{{{
asadmin create-domain --user admin --portbase 2000 --savemasterpassword=true domain2
}}}

 * Admin port: portbase + 48;
 * HTTP listener port: portbase + 80;
 * HTTPS listener port: portbase + 81.


3. Add the following files the relevant locations in the new Glassfish domain; 

 * ojdbc14.jar 
{{{
/home/glassfish3/glassfish3/glassfish/domains/domain2/lib 
}}}

 * icat.properties
{{{
/home/glassfish3/glassfish3/glassfish/domains/domain2/config 
}}}

4. If a new Glassfish admin password is used, make changes to:
 * icat40b/passwordfile 
{{{
AS_ADMIN_PASSWORD=adminadmin2
}}}

5. Set-up separate schemas for ICATs on Oracle;

e.g icatb/myicatpasswdb and icatuserb/myicatuserpasswdb

6. Make changes to the following files to reflect the new file directories, schemas and ports:
 * icat40b/glassfish.props 
{{{
1 	# URL for oracle (for a local system on XE it is just: url="jdbc:oracle:thin:@//localhost:1521/XE")
2 	url="jdbc:oracle:thin:@//localhost:1521/XE"
3 	
4 	icatName=ICATb
5 	icatPW=myicatpasswdb
6 	
7 	# ICATUSER user name and password in database
8 	icatuserName=ICATUSERb
9 	icatuserPW=myicatuserpasswdb
10 	
11 	# Must contain "glassfish/domains"
12 	glassfish=/home/glassfish3/glassfish3
13 	
14 	# Parameters for glassfish admin calls (normally 4848, admin and passwordfile)
15 	port=2048
16 	adminuser=admin
17 	passwordfile=passwordfile
18      domain=domain2
19 	
20 	# The ICAT ear file
21 	icat=/home/glassfish3/icat40b/icat-ear-1583-http.ear
}}}
Remember to add the new domain.


 * icat40b/usertable_init/usertable.sh
{{{
1 	sqlplus icatuserb/myicatuserpasswdb@localhost 
2 	INSERT INTO USER_TABLE (USER_ID, PASSWORD)
3 	               VALUES ('icat40', 'icat40passwd');
}}}

 * icat40b/test_icat/example.properties
{{{
1 	# $Id: example.properties 1668 2012-01-31 15:39:12Z crcamills@gmail.com $
2 	wsdl.location=http://localhost:2080/ICATService/ICAT?wsdl
3 	
}}}



7. Deploy ICAT following the standard [http://code.google.com/p/icatproject/wiki/InstallIcat40 installation guide], substituting the new schema names where appropriate.


= - the end - =