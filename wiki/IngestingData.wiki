The easiest way to get data into ICAT is to use the ingestMetadata API method.

This takes in an XML document (string) conforming to the description here: [http://code.google.com/p/icatproject/source/browse/icat3_api/trunk/icat3-jaxb/src/uk/icat3/jaxb/icatXSD.xsd]

Typically at facilities this is a two part process:
  # Ingest proposal metadata for the experiment before it takes place (create an investigation).
  # Ingest datafiles into that investigation as they are created on the beamline.

Below is an example which will work with a 'default' ICAT install (an ICAT created by following all the instructions here [http://code.google.com/p/icatproject/wiki/Database_Installation]

Assumptions for the files provided
  # id=3, USER_ID=damian exists in ICATUSER.USER_TABLE
  # id=4, USER_ID=doug exists in ICATUSER.USER_TABLE
  # Matching FEDERAL_ID=damian record in ICAT.FACILITY_USER
  # Matching FEDERAL_ID=doug record in ICAT.FACILITY_USER

General Comments
  # in the XML file the investigator user_id should = the FACILITY_USER.FACILITY_USER_ID
  # Run the ingest as 'overlord' (or equivalent user) - can use loginAdmin 


1) Proposal pre-ingest XML: file available here [http://icatproject.googlecode.com/svn/icat3_api/trunk/Documentation/examplefiles/preingest.xml]
{{{
<?xml version="1.0" encoding="utf-8"?>
<icat version="1.0 RC6" xsi:noNamespaceSchemaLocation="../icatXSD/icatXSD.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <study>
    <investigation>
      <inv_number>1010611</inv_number>
      <visit_id>1</visit_id>
      <instrument>MAPS</instrument>
      <title>Proposal title would go here</title>
      <investigator>
        <user_id>9932</user_id>
        <role>experimenter</role>
        <privilege>READER</privilege>
      </investigator>
      <investigator>
        <user_id>9933</user_id>
        <role>principal_experimenter</role>
        <privilege>ADMIN</privilege>
      </investigator>
      <inv_abstract>abstract would go here and would be very interesting to read</inv_abstract>
      <inv_type>Experiment</inv_type>
      <keyword>
        <name>abstract</name>
      </keyword>
      <keyword>
        <name>proposal</name>
      </keyword>
      <keyword>
        <name>hydrogen</name>
      </keyword>
      <sample>
        <name>Carbon</name>
        <chemical_formula>C</chemical_formula>
        <safety_information>Safe</safety_information>
        <parameter>
          <name>Sample Type</name>
          <string_value>Solid</string_value>
          <units>N/A</units>
        </parameter>
        <parameter>
          <name>Weight</name>
          <numeric_value>50</numeric_value>
          <units>g</units>
        </parameter>
        <parameter>
          <name>Sample Environment Requested</name>
          <string_value>CCR</string_value>
          <units>N/A</units>
        </parameter>
      </sample>
      <sample>
        <name>Hydrogen</name>
        <chemical_formula>H</chemical_formula>
        <safety_information>Hydrogen is highly  flammable.</safety_information>
        <parameter>
          <name>Sample Type</name>
          <string_value>Gas</string_value>
          <units>N/A</units>
        </parameter>
        <parameter>
          <name>Weight</name>
          <numeric_value>50</numeric_value>
          <units>g</units>
        </parameter>
      </sample>
    </investigation>
  </study>
</icat>
}}}

2) DataFile Ingest (typically repeated many times during the experiment - for each file set) file available here [http://icatproject.googlecode.com/svn/icat3_api/trunk/Documentation/examplefiles/example_file_ingest.xml]

{{{
<?xml version="1.0" encoding="utf-8"?>
<icat version="1.0 RC6" xsi:noNamespaceSchemaLocation="../icatXSD/icatXSD.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <study>
    <investigation>
      <inv_number>1010611</inv_number>
      <visit_id>1</visit_id>
      <instrument>MAPS</instrument>
      <title>Proposal title would go here</title>
      <inv_type>EXPERIMENT</inv_type>
      <bcat_inv_str>MAPS team -</bcat_inv_str>
      <keyword>
        <name>Davide</name>
      </keyword>
      <keyword>
        <name>-</name>
      </keyword>
      <keyword>
        <name>Quiet</name>
      </keyword>
      <keyword>
        <name>count-PH</name>
      </keyword>
      <keyword>
        <name>Mode</name>
      </keyword>
      <dataset>
        <name>Default</name>
        <dataset_type>EXPERIMENT_RAW</dataset_type>
        <dataset_status>COMPLETE</dataset_status>
        <description>WIS17323 MAPS team Davide - Quiet count-PH
        08-JUL-2010 14:05:29 0.00</description>
        <sample>
          <name>Davide - Quiet count-PH Mode</name>
          <safety_information>No information
          available</safety_information>
        </sample>
        <datafile>
          <name>MAPS00017323.raw</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS//MAPS00017323.raw</location>
          <description>Davide - Quiet count-PH Mode</description>
          <datafile_format>isis neutron raw</datafile_format>
          <datafile_format_version>2</datafile_format_version>
          <datafile_create_time>
          2010-07-08T14:05:29</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T11:32:00</datafile_modify_time>
          <file_size>451466240</file_size>
          <parameter>
            <name>run_number</name>
            <numeric_value>17323</numeric_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>run_header</name>
            <string_value>WIS17323 MAPS team Davide - Quiet
            count-PH 08-JUL-2010 14:05:29 0.00</string_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>number_of_detectors</name>
            <numeric_value>389125</numeric_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>primary_flight_path</name>
            <numeric_value>0</numeric_value>
            <units>m</units>
          </parameter>
          <parameter>
            <name>source_to_detector_distance</name>
            <numeric_value>0</numeric_value>
            <units>m</units>
          </parameter>
          <parameter>
            <name>run_title</name>
            <string_value>Davide - Quiet count-PH
            Mode</string_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>short_title</name>
            <string_value>Davide - Quiet count-PH</string_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>start_date</name>
            <string_value>2010-07-08 14:05:29</string_value>
            <units>yyyy-MM-dd HH:mm:ss</units>
          </parameter>
          <parameter>
            <name>finish_date</name>
            <string_value>2010-08-11 11:54:49</string_value>
            <units>yyyy-MM-dd HH:mm:ss</units>
          </parameter>
          <parameter>
            <name>run_duration</name>
            <numeric_value>2929204</numeric_value>
            <units>seconds</units>
          </parameter>
          <parameter>
            <name>good_proton_charge</name>
            <numeric_value>0</numeric_value>
            <units>uAmp hours</units>
          </parameter>
          <parameter>
            <name>total_proton_charge</name>
            <numeric_value>0</numeric_value>
            <units>uAmp hours</units>
          </parameter>
          <parameter>
            <name>good_frames</name>
            <numeric_value>146341573</numeric_value>
            <units>pulses</units>
          </parameter>
          <parameter>
            <name>monitor_sum1</name>
            <numeric_value>274363688</numeric_value>
            <units>neutrons</units>
          </parameter>
          <parameter>
            <name>monitor_sum2</name>
            <numeric_value>0</numeric_value>
            <units>neutrons</units>
          </parameter>
          <parameter>
            <name>monitor_sum3</name>
            <numeric_value>0</numeric_value>
            <units>neutrons</units>
          </parameter>
          <parameter>
            <name>number_of_periods</name>
            <numeric_value>1</numeric_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>number_of_spectra</name>
            <numeric_value>97285</numeric_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>number_of_time_channels</name>
            <numeric_value>4471</numeric_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>time_channel_parameters</name>
            <string_value>5000 99900 0.00067</string_value>
            <units>N/A</units>
          </parameter>
          <parameter>
            <name>Void</name>
            <numeric_value>0</numeric_value>
            <units>?</units>
            <description>0</description>
          </parameter>
        </datafile>
        <datafile>
          <name>MAPS00017323.log</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323.log</location>
          <datafile_create_time>
          2010-07-08T12:20:25.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T12:20:25.0</datafile_modify_time>
          <file_size>193946930</file_size>
        </datafile>
        <datafile>
          <name>MAPS00017323_ICPdebug.txt</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323_ICPdebug.txt</location>
          <datafile_create_time>
          2010-07-08T12:20:21.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T12:20:21.0</datafile_modify_time>
          <file_size>9116</file_size>
        </datafile>
        <datafile>
          <name>MAPS00017323_ICPevent.txt</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323_ICPevent.txt</location>
          <datafile_create_time>
          2010-07-08T14:05:29.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T14:05:29.0</datafile_modify_time>
          <file_size>1062</file_size>
        </datafile>
        <datafile>
          <name>MAPS00017323_ICPmonitoring.txt</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323_ICPmonitoring.txt</location>
          <datafile_create_time>
          2010-07-08T14:05:30.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T14:05:30.0</datafile_modify_time>
          <file_size>34770978</file_size>
        </datafile>
        <datafile>
          <name>MAPS00017323_ICPstatus.txt</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323_ICPstatus.txt</location>
          <datafile_create_time>
          2010-07-08T12:20:21.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T12:20:21.0</datafile_modify_time>
          <file_size>6865266</file_size>
        </datafile>
        <datafile>
          <name>MAPS00017323_Status.txt</name>
          <location>
          file://S:/Cycles$/cycle_10_2/NDXMAPS/MAPS00017323_Status.txt</location>
          <datafile_create_time>
          2010-07-08T12:20:25.0</datafile_create_time>
          <datafile_modify_time>
          2010-08-11T12:20:25.0</datafile_modify_time>
          <file_size>15675755</file_size>
        </datafile>
      </dataset>
    </investigation>
  </study>
</icat>
}}}

3) Some example (C#) code to plug it all together
{{{
//Create connections to the ICAT-Admin and ICAT web services
            ICAT.ICATService service = new ICATTesting.ICAT.ICATService();
            ICATAdmin.ICATAdminService adminService = new ICATTesting.ICATAdmin.ICATAdminService();
            adminService.Credentials = new NetworkCredential("ISIS-admin", "icatadmin");
            
            //Login using the admin webservice
            string adminAuth = adminService.loginAdmin("overlord");


            //ingest the pre-experiment XML
            
            string PreIngestXml = /*insert some code to read the pre-ingest xml file*/;
            string FileIngestXml = /*insert some code to read the file-ingest xml file*/;
            
            long?[] investigationIds = service.ingestMetadata(adminAuth, PreIngestXml);
            long?[] sameInvestigationIds = service.ingestMetadata(adminAuth, FileIngestXml);
}}}