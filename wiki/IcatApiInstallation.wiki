#summary ICAT API Installation.
#labels Installation,Featured,Icat-Api

== ICAT API Installation from Binary ==
Author(s): Glen Drinkwater

=== Introduction ===

This document is to guide an administrator through the steps needed to install the ICAT API v3.3 onto Glassfish v2 UR2 b4 on Microsoft Windows or Linux.

=== Hardware Requirements ===
  
|| *OS* || *Minimum RAM* || *Recommended RAM* || 
|| Linux|| 512MB || 1GB ||
|| Windows || 1GB || 2GB ||


=== Prerequisites ===

The installation needs the following software installed:
  #  Java 6 Update 6 from http://java.sun.com/javase/downloads/index.jsp
  #  Apache Ant v1.7+ from http://ant.apache.org
  #  Glassfish v2 UR2 b4 from https://glassfish.dev.java.net/downloads/v2ur2-b04.html
  #  <Optional>Installed and configured Java Cog Kit from http://wiki.cogkit.org/index.php/Main_Page, help http://www.globus.org/cog/distribution/1.2/FAQ.TXT NB: This is only needed for running of the ICAT API and not the installation. (SYC 21/08/2008 - also see CogkitConfig.)

The installation also needs these databases accessible.
  #  An installed ICAT 3.3 schema instance on an Oracle DB 
  #  An accessible empty schema for the ICAT API user session tables on an Oracle DB

*_Note_* From now on {{{<JAVA_HOME>}}} and {{{<GLASSFISH_HOME>}}} represent the root directory installation of Java and Glassfish respectively.	

If you have already installed the Data Portal, please go to section 3 and then onto 7 or 8 depending whether Glassfish is currently running.

=== Installation ===
  # Download and unpack the installation.zip file provided by Devigo
    *. This contains all the binary jars and ant scripts needed to install ICAT API
    * This will be known as the {{{<INSTALLATION_HOME>}}}
  # Check ant is installed with the correct version by executing this from the command prompt:
    * {{{ $ant -version }}}          Apache Ant version  1.7.0 compiled on December 13 2006
  # Configure the *{{{<INSTALLATION_HOME>/nbproject/database.properties}}}* file.
    * Configure the ICAT schema
      * Add your own values to the icat.user, icat.url and icat.password properties
      * This is for the main ICAT schema’s username, password and url
      * Note that icat.url must be in Oracle JBDC format, i.e. start with jdbc:oracle:thin:@ See Note Below
    * Configure the ICAT user session schema (SYC 20Aug2008 - the ICAT user session database will be installed by the ant target if it doesn't exist.  If you need to install a separate database for development use, I have the schema ddl.)
      * Add your own values to the icatuser.user, icatuser.url and icatuser.password properties
      * This is for the ICAT API user session schema’s username, password and url
      * Note that icatuser.url must be in Oracle JDBC format, i.e. start with jdbc:oracle:thin:@  See Note Below
    * Configure the name of facility you wish to install.
      * Change facility.name to either ISIS or DLS
      * '''NB:''' This will either install the version of ICAT API for ISIS or DLS
  # Configure the *{{{<INSTALLATION_HOME>/nbproject/glassfish.properties}}}* file.
    * Configure the application server Glassfish
      * If you are using the default Glassfish installation sjsas.admin.port, sjsas.http.port, sjsas.password, sjsas.host, sjsas.username and sjsas.domain can leave alone.
     * Change *sjsas.root* to the *{{{<GLASSFISH_HOME>}}}* remembering to add the escape character \ if you are on windows for :  and \
     * Change admin.auth.password to the password you wish to add for the admin ICAT API web services.  The username will be *facility.name-admin* from 3 c) i) i.e. '''DLS-admin'''
    * This step can be skipped if you have already installed the Data Portal 
  # Now the configuration is finished the installation can start with a series of ant commands executed in the {{{<INSTALLATION_HOME>}}}
  # *{{{ $ ant –f icat.xml init-config }}}*
    * Copies the required files onto the Glassfish server i.e. Oracle’s JDBC driver
    * Copies a jar file to fix a bug in the StAX Parser in Java 6.
       * *NB:* If you are using Linux, you will need to manually copy *{{{<INSTALLATION_HOME>/lib/wstx-asl-3.9.2.jar}}}* into *{{{<JAVA_HOME>/jre/lib/endorsed}}}* creating the endorsed directory if it does not exist.
  # *{{{ $ ant –f icat.xml start-domain }}}*
    * Starts the Glassfish server, if it complains of not starting, check http://localhost:4848. 
    * If it still has not started use the commands {{{<GLASSFISH_HOME>/bin/asadmin start-domain domain1}}} and {{{<GLASSFISH_HOME>/bin/asadmin stop-domain domain1}}} to start and stop the default domain domain1
  # *{{{ $ ant –f icat.xml install }}}*
    * Creates all the glassfish data sources and connection pools and deploys the *icat-api.ws.jar* onto Glassfish
    * If you are reinstalling this then some errors will occur saying it cannot create some tables, do not worry about this, it just means the tables have already been recreated.
    * If you experience a fail and error in the context of database connection that includes: Class not found, check to see if there is a 'ojdbc14.jar' in {{{<GLASSFISH_HOME>domains/domain1/lib/}}}. If there is not one present, the copy it there from {{{<INSTALLATION_HOME>/lib/ojdbc14.jar}}}.
  # *{{{ $ ant –f icat.xml configure-icat-db }}}*
    * Configures the MyProxy Servers and enables SUPER and ADMIN for ICAT API admin logins
  # *{{{ $ ant –f icat.xml restart-domain }}}*
    * Allows the changes to 9 to be picked up from the database.
  # To check if the installation is correct, check _https://localhost:8181/ICATService/ICAT?wsdl_ to view the WSDL file.

=== See Also ===

[source:"ICAT/DevigoTutorial/ICAT API Installation.doc"  Data Portal Installation]

[source:"ICAT/DevigoTutorial/DataPortal and ICAT Installation.pdf" Data Portal and ICAT Installation Presentation]


== Notes ==
icat.url (example for point 3) ::

  jdbc:oracle:thin:@localhost:1521:XE